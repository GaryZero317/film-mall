<!--pages/user/film/detail/index.wxml-->
<view class="container" wx:if="{{orderDetail}}">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="back-icon" bindtap="onBack">
      <text class="iconfont icon-back"></text>
    </view>
    <text class="header-title">è®¢å•è¯¦æƒ…</text>
  </view>
  
  <!-- è®¢å•çŠ¶æ€ -->
  <view class="status-card" style="background-color: {{statusMap[orderDetail.status].color}}">
    <view class="status-text">{{orderDetail.status_desc}}</view>
    <view class="status-desc" wx:if="{{orderDetail.status === 0}}">è¯·å°½å¿«å®Œæˆæ”¯ä»˜</view>
    <view class="status-desc" wx:elif="{{orderDetail.status === 1}}">æ­£åœ¨ä¸ºæ‚¨å†²æ´—èƒ¶ç‰‡ä¸­</view>
    <view class="status-desc" wx:elif="{{orderDetail.status === 2}}">æ‚¨çš„èƒ¶ç‰‡å·²å†²æ´—å®Œæˆï¼Œç­‰å¾…æ”¶è´§</view>
    <view class="status-desc" wx:elif="{{orderDetail.status === 3}}">æ„Ÿè°¢æ‚¨çš„æ”¯æŒ</view>
  </view>
  
  <!-- è®¢å•ä¿¡æ¯ -->
  <view class="card order-info">
    <view class="card-title">è®¢å•ä¿¡æ¯</view>
    <view class="info-item">
      <text class="label">è®¢å•ç¼–å·</text>
      <view class="value-wrap">
        <text class="value order-id">{{orderDetail.foid}}</text>
        <text class="copy-btn" bindtap="copyOrderNo">å¤åˆ¶</text>
      </view>
    </view>
    <view class="info-item">
      <text class="label">åˆ›å»ºæ—¶é—´</text>
      <text class="value">{{orderDetail.create_time}}</text>
    </view>
    <view class="info-item">
      <text class="label">å›å¯„åº•ç‰‡</text>
      <text class="value tag {{orderDetail.return_film ? 'tag-success' : 'tag-default'}}">
        {{orderDetail.return_film ? 'æ˜¯' : 'å¦'}}
      </text>
    </view>
    <view class="info-item" wx:if="{{orderDetail.remark}}">
      <text class="label">å¤‡æ³¨</text>
      <text class="value remark">{{orderDetail.remark}}</text>
    </view>
  </view>
  
  <!-- èƒ¶ç‰‡è¯¦æƒ… -->
  <view class="card">
    <view class="card-title">èƒ¶ç‰‡è¯¦æƒ…</view>
    <view class="film-items">
      <view class="film-item" wx:for="{{orderDetail.items}}" wx:key="id">
        <view class="film-info">
          <view class="film-type">{{item.film_type}} {{item.film_brand}}</view>
          <view class="film-size">{{item.size}}</view>
          <view class="film-remark" wx:if="{{item.remark}}">å¤‡æ³¨ï¼š{{item.remark}}</view>
        </view>
        <view class="film-price">
          <text class="quantity">x{{item.quantity}}</text>
          <text class="price">Â¥{{item.price/100}}</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ä»·æ ¼æ±‡æ€» -->
  <view class="card price-summary">
    <view class="summary-item">
      <text>èƒ¶ç‰‡å†²æ´—è´¹</text>
      <text>Â¥{{orderDetail.total_price/100}}</text>
    </view>
    <view class="summary-item">
      <text>è¿è´¹</text>
      <text>Â¥{{orderDetail.shipping_fee/100}}</text>
    </view>
    <view class="summary-item total">
      <text>å®ä»˜æ¬¾</text>
      <text class="total-price">Â¥{{(orderDetail.total_price + orderDetail.shipping_fee)/100}}</text>
    </view>
  </view>
  
  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="footer-btns">
    <block wx:if="{{orderDetail.status === 0}}">
      <button class="footer-btn pay-btn" bindtap="payOrder">
        <text class="btn-icon">ï¿¥</text> ç«‹å³æ”¯ä»˜
      </button>
    </block>
    <block wx:elif="{{orderDetail.status === 2}}">
      <button class="footer-btn" bindtap="viewLogistics">
        <text class="btn-icon">ğŸšš</text> æŸ¥çœ‹ç‰©æµ
      </button>
      <button class="footer-btn confirm-btn" bindtap="confirmReceive">
        ç¡®è®¤æ”¶è´§
      </button>
    </block>
    <block wx:if="{{orderDetail.status >= 1}}">
      <button class="footer-btn photo-btn" bindtap="viewPhotos" data-id="{{orderDetail.id}}">
        <text class="btn-icon">ğŸ“·</text> æŸ¥çœ‹å†²æ´—ç…§ç‰‡
      </button>
    </block>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading-container" wx:else>
  <view class="loading-icon"></view>
  <view wx:if="{{loading}}">åŠ è½½ä¸­...</view>
  <view wx:else>è®¢å•ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</view>
</view> 